<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zfsoft.ha.dbaccess.dao.DbHaWorkUserScheduleMapper">
    <resultMap id="BaseResultMap" type="com.zfsoft.ha.dbaccess.data.DbHaWorkUserSchedule">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="WORK_USER_ID" jdbcType="BIGINT" property="workUserId"/>
        <result column="WORK_DATE" jdbcType="TIMESTAMP" property="workDate"/>
        <result column="DAY_OF_WEEK" jdbcType="VARCHAR" property="dayOfWeek"/>
        <result column="YEAR_MONTH" jdbcType="VARCHAR" property="yearMonth"/>
        <result column="AM_OR_PM" jdbcType="VARCHAR" property="amOrPm"/>
        <result column="SCHEDULE_STATUS" jdbcType="VARCHAR" property="scheduleStatus"/>
        <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
    </resultMap>

    <resultMap id="BaseResultVoMap" type="com.zfsoft.ha.dbaccess.data.vo.DbHaWorkUserScheduleVo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="WORK_USER_ID" jdbcType="BIGINT" property="workUserId"/>
        <result column="WORK_DATE" jdbcType="TIMESTAMP" property="workDate"/>
        <result column="DAY_OF_WEEK" jdbcType="VARCHAR" property="dayOfWeek"/>
        <result column="YEAR_MONTH" jdbcType="VARCHAR" property="yearMonth"/>
        <result column="AM_OR_PM" jdbcType="VARCHAR" property="amOrPm"/>
        <result column="SCHEDULE_STATUS" jdbcType="VARCHAR" property="scheduleStatus"/>
        <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>

        <result column="WORK_USER_NAME" jdbcType="VARCHAR" property="workUserName"/>
        <result column="GROUP_ID" jdbcType="BIGINT" property="groupId"/>
        <result column="GROUP_NAME" jdbcType="VARCHAR" property="groupName"/>
        <result column="WAIT_NUM" jdbcType="INTEGER" property="waitNum"/>
        <result column="SERVICE_ING_NUM" jdbcType="INTEGER" property="serviceIngNum"/>
        <result column="HA_TYPE" jdbcType="VARCHAR" property="haType"/>

        <result column="STATUS" jdbcType="VARCHAR" property="status"/>
    </resultMap>

    <resultMap id="BaseResultAppVoMap" type="com.zfsoft.ha.dbaccess.data.vo.DbHaWorkUserSchedule_AppVo">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="ID" jdbcType="BIGINT" property="id"/>
        <result column="WORK_USER_ID" jdbcType="BIGINT" property="workUserId"/>
        <result column="WORK_DATE" jdbcType="TIMESTAMP" property="workDate"/>
        <result column="DAY_OF_WEEK" jdbcType="VARCHAR" property="dayOfWeek"/>
        <result column="YEAR_MONTH" jdbcType="VARCHAR" property="yearMonth"/>
        <result column="AM_OR_PM" jdbcType="VARCHAR" property="amOrPm"/>
        <result column="SCHEDULE_STATUS" jdbcType="VARCHAR" property="scheduleStatus"/>
        <result column="CREATE_BY" jdbcType="VARCHAR" property="createBy"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_BY" jdbcType="VARCHAR" property="updateBy"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>

        <result column="t_8_9" jdbcType="VARCHAR" property="t_8_9"/>
        <result column="t_9_10" jdbcType="VARCHAR" property="t_9_10"/>
        <result column="t_10_11" jdbcType="VARCHAR" property="t_10_11"/>
        <result column="t_13_14" jdbcType="VARCHAR" property="t_13_14"/>
        <result column="t_14_15" jdbcType="VARCHAR" property="t_14_15"/>

    </resultMap>
    <sql id="Example_Where_Clause">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Update_By_Example_Where_Clause">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <where>
            <foreach collection="example.oredCriteria" item="criteria" separator="or">
                <if test="criteria.valid">
                    <trim prefix="(" prefixOverrides="and" suffix=")">
                        <foreach collection="criteria.criteria" item="criterion">
                            <choose>
                                <when test="criterion.noValue">
                                    and ${criterion.condition}
                                </when>
                                <when test="criterion.singleValue">
                                    and ${criterion.condition} #{criterion.value}
                                </when>
                                <when test="criterion.betweenValue">
                                    and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                                </when>
                                <when test="criterion.listValue">
                                    and ${criterion.condition}
                                    <foreach close=")" collection="criterion.value" item="listItem" open="("
                                             separator=",">
                                        #{listItem}
                                    </foreach>
                                </when>
                            </choose>
                        </foreach>
                    </trim>
                </if>
            </foreach>
        </where>
    </sql>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        ID, WORK_USER_ID, WORK_DATE, DAY_OF_WEEK, `YEAR_MONTH`, AM_OR_PM, SCHEDULE_STATUS,
        CREATE_BY, CREATE_DATE, UPDATE_BY, UPDATE_DATE
    </sql>
    <select id="selectByExample" parameterType="com.zfsoft.ha.dbaccess.data.example.DbHaWorkUserScheduleExample"
            resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <if test="distinct">
            distinct
        </if>
        <include refid="Base_Column_List"/>
        from t_ha_work_user_schedule
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
        <if test="orderByClause != null">
            order by ${orderByClause}
        </if>
    </select>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from t_ha_work_user_schedule
        where ID = #{id,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_ha_work_user_schedule
        where ID = #{id,jdbcType=BIGINT}
    </delete>
    <delete id="deleteByExample" parameterType="com.zfsoft.ha.dbaccess.data.example.DbHaWorkUserScheduleExample">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from t_ha_work_user_schedule
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </delete>
    <insert id="insert" parameterType="com.zfsoft.ha.dbaccess.data.DbHaWorkUserSchedule">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_ha_work_user_schedule ( WORK_USER_ID, WORK_DATE,
        DAY_OF_WEEK, `YEAR_MONTH`, AM_OR_PM,
        SCHEDULE_STATUS, CREATE_BY, CREATE_DATE,
        UPDATE_BY, UPDATE_DATE)
        values ( #{workUserId,jdbcType=BIGINT}, #{workDate,jdbcType=TIMESTAMP},
        #{dayOfWeek,jdbcType=VARCHAR}, #{yearMonth,jdbcType=VARCHAR}, #{amOrPm,jdbcType=VARCHAR},
        #{scheduleStatus,jdbcType=VARCHAR}, #{createBy,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP},
        #{updateBy,jdbcType=VARCHAR}, #{updateDate,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.zfsoft.ha.dbaccess.data.DbHaWorkUserSchedule">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into t_ha_work_user_schedule
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                ID,
            </if>
            <if test="workUserId != null">
                WORK_USER_ID,
            </if>
            <if test="workDate != null">
                WORK_DATE,
            </if>
            <if test="dayOfWeek != null">
                DAY_OF_WEEK,
            </if>
            <if test="yearMonth != null">
                `YEAR_MONTH`,
            </if>
            <if test="amOrPm != null">
                AM_OR_PM,
            </if>
            <if test="scheduleStatus != null">
                SCHEDULE_STATUS,
            </if>
            <if test="createBy != null">
                CREATE_BY,
            </if>
            <if test="createDate != null">
                CREATE_DATE,
            </if>
            <if test="updateBy != null">
                UPDATE_BY,
            </if>
            <if test="updateDate != null">
                UPDATE_DATE,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id,jdbcType=BIGINT},
            </if>
            <if test="workUserId != null">
                #{workUserId,jdbcType=BIGINT},
            </if>
            <if test="workDate != null">
                #{workDate,jdbcType=TIMESTAMP},
            </if>
            <if test="dayOfWeek != null">
                #{dayOfWeek,jdbcType=VARCHAR},
            </if>
            <if test="yearMonth != null">
                #{yearMonth,jdbcType=VARCHAR},
            </if>
            <if test="amOrPm != null">
                #{amOrPm,jdbcType=VARCHAR},
            </if>
            <if test="scheduleStatus != null">
                #{scheduleStatus,jdbcType=VARCHAR},
            </if>
            <if test="createBy != null">
                #{createBy,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateBy != null">
                #{updateBy,jdbcType=VARCHAR},
            </if>
            <if test="updateDate != null">
                #{updateDate,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <select id="countByExample" parameterType="com.zfsoft.ha.dbaccess.data.example.DbHaWorkUserScheduleExample"
            resultType="java.lang.Long">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select count(*) from t_ha_work_user_schedule
        <if test="_parameter != null">
            <include refid="Example_Where_Clause"/>
        </if>
    </select>
    <update id="updateByExampleSelective" parameterType="map">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_ha_work_user_schedule
        <set>
            <if test="record.id != null">
                ID = #{record.id,jdbcType=BIGINT},
            </if>
            <if test="record.workUserId != null">
                WORK_USER_ID = #{record.workUserId,jdbcType=BIGINT},
            </if>
            <if test="record.workDate != null">
                WORK_DATE = #{record.workDate,jdbcType=TIMESTAMP},
            </if>
            <if test="record.dayOfWeek != null">
                DAY_OF_WEEK = #{record.dayOfWeek,jdbcType=VARCHAR},
            </if>
            <if test="record.yearMonth != null">
                `YEAR_MONTH` = #{record.yearMonth,jdbcType=VARCHAR},
            </if>
            <if test="record.amOrPm != null">
                AM_OR_PM = #{record.amOrPm,jdbcType=VARCHAR},
            </if>
            <if test="record.scheduleStatus != null">
                SCHEDULE_STATUS = #{record.scheduleStatus,jdbcType=VARCHAR},
            </if>
            <if test="record.createBy != null">
                CREATE_BY = #{record.createBy,jdbcType=VARCHAR},
            </if>
            <if test="record.createDate != null">
                CREATE_DATE = #{record.createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="record.updateBy != null">
                UPDATE_BY = #{record.updateBy,jdbcType=VARCHAR},
            </if>
            <if test="record.updateDate != null">
                UPDATE_DATE = #{record.updateDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByExample" parameterType="map">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_ha_work_user_schedule
        set ID = #{record.id,jdbcType=BIGINT},
        WORK_USER_ID = #{record.workUserId,jdbcType=BIGINT},
        WORK_DATE = #{record.workDate,jdbcType=TIMESTAMP},
        DAY_OF_WEEK = #{record.dayOfWeek,jdbcType=VARCHAR},
        `YEAR_MONTH` = #{record.yearMonth,jdbcType=VARCHAR},
        AM_OR_PM = #{record.amOrPm,jdbcType=VARCHAR},
        SCHEDULE_STATUS = #{record.scheduleStatus,jdbcType=VARCHAR},
        CREATE_BY = #{record.createBy,jdbcType=VARCHAR},
        CREATE_DATE = #{record.createDate,jdbcType=TIMESTAMP},
        UPDATE_BY = #{record.updateBy,jdbcType=VARCHAR},
        UPDATE_DATE = #{record.updateDate,jdbcType=TIMESTAMP}
        <if test="_parameter != null">
            <include refid="Update_By_Example_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective" parameterType="com.zfsoft.ha.dbaccess.data.DbHaWorkUserSchedule">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_ha_work_user_schedule
        <set>
            <if test="workUserId != null">
                WORK_USER_ID = #{workUserId,jdbcType=BIGINT},
            </if>
            <if test="workDate != null">
                WORK_DATE = #{workDate,jdbcType=TIMESTAMP},
            </if>
            <if test="dayOfWeek != null">
                DAY_OF_WEEK = #{dayOfWeek,jdbcType=VARCHAR},
            </if>
            <if test="yearMonth != null">
                `YEAR_MONTH` = #{yearMonth,jdbcType=VARCHAR},
            </if>
            <if test="amOrPm != null">
                AM_OR_PM = #{amOrPm,jdbcType=VARCHAR},
            </if>
            <if test="scheduleStatus != null">
                SCHEDULE_STATUS = #{scheduleStatus,jdbcType=VARCHAR},
            </if>
            <if test="createBy != null">
                CREATE_BY = #{createBy,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
            </if>
            <if test="updateBy != null">
                UPDATE_BY = #{updateBy,jdbcType=VARCHAR},
            </if>
            <if test="updateDate != null">
                UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP},
            </if>
        </set>
        where ID = #{id,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.zfsoft.ha.dbaccess.data.DbHaWorkUserSchedule">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update t_ha_work_user_schedule
        set WORK_USER_ID = #{workUserId,jdbcType=BIGINT},
        WORK_DATE = #{workDate,jdbcType=TIMESTAMP},
        DAY_OF_WEEK = #{dayOfWeek,jdbcType=VARCHAR},
        `YEAR_MONTH` = #{yearMonth,jdbcType=VARCHAR},
        AM_OR_PM = #{amOrPm,jdbcType=VARCHAR},
        SCHEDULE_STATUS = #{scheduleStatus,jdbcType=VARCHAR},
        CREATE_BY = #{createBy,jdbcType=VARCHAR},
        CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},
        UPDATE_BY = #{updateBy,jdbcType=VARCHAR},
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP}
        where ID = #{id,jdbcType=BIGINT}
    </update>

    <select id="queryScheduleList" resultMap="BaseResultVoMap">
        select
        a.ID, a.WORK_USER_ID, a.WORK_DATE, a.DAY_OF_WEEK, a.`YEAR_MONTH`, a.AM_OR_PM, a.SCHEDULE_STATUS,
        hw.NAME as WORK_USER_NAME,
        hw.STATUS,
        hg.ID as GROUP_ID,
        hg.NAME as GROUP_NAME
        from t_ha_work_user_schedule a
        left join t_ha_help_work_user hw
        on hw.ID = a.WORK_USER_ID
        left join t_ha_work_user_group hg
        on hg.ID = hw.GROUP_ID
        <where>
            <if test="yearMonth != null and yearMonth != ''">
                AND a.`YEAR_MONTH` = #{yearMonth}
            </if>
            <if test="groupId != null">
                AND hg.ID = #{groupId}
            </if>
            <if test="workUserName != null and workUserName != ''">
                AND hw.NAME like concat('%',#{workUserName},'%')
            </if>
        </where>
        ORDER BY a.WORK_DATE DESC
    </select>
    <select id="queryList" resultMap="BaseResultMap">
        select
        a.ID, a.WORK_USER_ID, a.WORK_DATE, a.DAY_OF_WEEK, a.`YEAR_MONTH`, a.AM_OR_PM, a.SCHEDULE_STATUS
        from t_ha_work_user_schedule a
        <where>
            <if test="yearMonth != null and yearMonth != ''">
                AND a.`YEAR_MONTH` = #{yearMonth}
            </if>
            <if test="workUserId != null">
                AND a.WORK_USER_ID = #{workUserId}
            </if>
        </where>
        ORDER BY a.WORK_DATE DESC
    </select>

  <select id="queryListByDayAndGroupidAndScheduleStatus" resultMap="BaseResultVoMap">
    select
    a.ID, a.WORK_USER_ID, a.WORK_DATE, a.DAY_OF_WEEK, a.`YEAR_MONTH`, a.AM_OR_PM, a.SCHEDULE_STATUS,
    hw.NAME as WORK_USER_NAME,
    hw.STATUS,
    hg.ID as GROUP_ID,
    hg.NAME as GROUP_NAME
    from t_ha_work_user_schedule  a
    left join t_ha_help_work_user hw
    on hw.ID = a.WORK_USER_ID
    left join t_ha_work_user_group hg
    on hg.ID = hw.GROUP_ID
    <where>
        <if test="workDate != null">
            and WORK_DATE = #{workDate}
        </if>
        <if test="groupId != null">
            AND hg.ID = #{groupId}
        </if>
        <if test="haType != null">
            AND hw.HA_TYPE = #{haType}
        </if>
        <if test="apm == '0'">
            AND  a.AM_OR_PM = '1' or a.AM_OR_PM = '3'
        </if>
        <if test="apm == '1'">
            AND  a.AM_OR_PM = '2' or a.AM_OR_PM = '3'
        </if>
    </where>
    ORDER BY a.WORK_DATE DESC
  </select>

  <select id="queryUserScheAndQueueListByDay" resultMap="BaseResultVoMap">
    select
    a.ID, a.WORK_USER_ID, a.WORK_DATE, a.DAY_OF_WEEK, a.`YEAR_MONTH`, a.AM_OR_PM, a.SCHEDULE_STATUS,
    hw.NAME as WORK_USER_NAME,
    hg.ID as GROUP_ID,
    hw.STATUS,
    hg.NAME as GROUP_NAME,
    hw.HA_TYPE as HA_TYPE,
    ifnull(hq.waitNum,0) as WAIT_NUM,
    ifnull(hq.singNum,0) as SERVICE_ING_NUM
      from t_ha_work_user_schedule  a
    left join t_ha_help_work_user hw
    on hw.ID = a.WORK_USER_ID
    and hw.DELETE_STATUS = '1'
    and hw.TAKE_NUM_STATUS = '1'
    left join t_ha_work_user_group hg
    on hg.ID = hw.GROUP_ID
    left join (select SERVICE_WORK_USER_ID,
                      count(case when SERVICE_STATUS='1' then '1'end) as waitNum,
                      count(case when SERVICE_STATUS='2' then '1'end) as singNum
                from t_ha_work_queue
                <where>
                    <if test="beginADay != null"><!-- 开始时间检索 -->
                        AND CREATE_DATE &gt;= #{beginADay}
                    </if>
                    <if test="endADay != null "><!-- 结束时间检索 -->
                        AND CREATE_DATE &lt;= #{endADay}
                    </if>
                </where>
                GROUP BY SERVICE_WORK_USER_ID) hq
    on hq.SERVICE_WORK_USER_ID = hw.ID

    <where>
        <if test="workDate != null">
            and WORK_DATE = #{workDate}
        </if>
        <if test="groupId != null">
            AND hg.ID = #{groupId}
        </if>
        <if test="haType != null">
            AND hw.HA_TYPE = #{haType}
        </if>
        <if test="apm == '0'">
            AND  a.AM_OR_PM = '1' or a.AM_OR_PM = '3'
        </if>
        <if test="apm == '1'">
            AND  a.AM_OR_PM = '2' or a.AM_OR_PM = '3'
        </if>
    </where>
    ORDER BY a.WORK_DATE DESC
    </select>

    <select id="queryScheAppList" resultMap="BaseResultAppVoMap">
        SELECT
        a.ID,
        a.WORK_USER_ID,
        a.WORK_DATE,
        a.DAY_OF_WEEK,
        a.`YEAR_MONTH`,
        a.AM_OR_PM,
        a.SCHEDULE_STATUS,
        COUNT(case when b.APPOINTMENT_TIME_PERIOD = '1' then 1 end) t_8_9,
        COUNT(case when b.APPOINTMENT_TIME_PERIOD = '2' then 1 end) t_9_10,
        COUNT(case when b.APPOINTMENT_TIME_PERIOD = '3' then 1 end) t_10_11,
        COUNT(case when b.APPOINTMENT_TIME_PERIOD = '4' then 1 end) t_13_14,
        COUNT(case when b.APPOINTMENT_TIME_PERIOD = '5' then 1 end) t_14_15

        FROM
        t_ha_work_user_schedule a
        left join
        t_ha_appointment b
        on b.SCHEDULE_ID = a.ID and b.APPOINTMENT_STATUS!='3'
        <where>

            a.WORK_USER_ID = #{workUserId}

            <if test="startDate != null and startDate != ''">
                and a.WORK_DATE &gt;= #{startDate}
            </if>
            <if test="endDate != null and endDate != ''">
                and a.WORK_DATE &lt;= #{endDate}
            </if>
            <if test="scheduleId != null and scheduleId != ''">
                and a.ID = #{scheduleId}
            </if>

        </where>

        group by b.SCHEDULE_ID,a.WORK_DATE

        ORDER BY
        a.WORK_DATE DESC
    </select>

    <!--获取帮办服务人数-->
    <select id="countWorkUsers" parameterType="java.lang.String"
            resultType="java.lang.Integer">
        select
        COUNT(WORK_USER_ID) as WORK_USERS
        FROM
        t_ha_work_user_schedule
        <where>
            SCHEDULE_STATUS = '1'
            <if test="workDate != null">
                and WORK_DATE = #{workDate}
            </if>
        </where>
    </select>


</mapper>
