<!--
 * @Author: haoxinguo haoxinguo@zhuofansoft.com
 * @Date: 2022-07-22 10:06:57
 * @LastEditors: haoxinguo haoxinguo@zhuofansoft.com
 * @LastEditTime: 2022-11-10 14:43:00
 * @FilePath: \hpNewHall\src\views\pad\assistant\components\process\materialUpload.vue
 * @Description: 材料上传
-->
<template>
  <div class="materialUpload-container" v-loading="tableLoading">
    <div class="material-content">
      <div class="materialList">
        <p class="dialogContentTitle" v-if="autoProduceMaterialList.length">
          系统智能生成材料
        </p>
        <div
          class="tableArea"
          v-if="autoProduceMaterialList.length"
          ref="tableArea"
        >
          <el-table
            border
            :data="autoProduceMaterialList"
            ref="autoProduceMaterialListTable"
            style="width: 100%; margin-left: 1px"
          >
            <el-table-column type="index" label="序号" width="50">
            </el-table-column>
            <template v-for="(item, index) in columnList">
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-if="item.prop === 'materialName'"
                align="left"
              >
                <template slot-scope="scope">
                  <p class="preview">
                    <span>{{ scope.row.materialName }}</span>
                    <img
                      v-show="
                        scope.row.showPreviewType === 'preview' ||
                        scope.row.showPreviewType === 'all'
                      "
                      @click="preView(scope.row, 'autoGenerate')"
                      :src="require('@/assets/images/home/previewSee.png')"
                      alt=""
                    />
                    <img
                      v-show="
                        scope.row.showPreviewType === 'download' ||
                        scope.row.showPreviewType === 'all'
                      "
                      @click="preView(scope.row, 'autoGenerateDown')"
                      :src="require('@/assets/images/home/downLoad.png')"
                      alt=""
                    />
                    <img
                        style="cursor: default"
                        v-show="scope.row.madeMaterialType === 1"
                        :src="require('@/assets/images/home/exemption.png')"
                        alt=""
                    />
                    <img
                        @click="preView(scope.row, 'empty')"
                        v-if="scope.row.materialEmptyAttoid"
                        :src="require('@/assets/images/home/emptyTable.png')"
                        alt=""
                    />
                    <img
                        @click="preView(scope.row, 'sample')"
                        v-if="
                      scope.row.materialSampleAddrYl ||
                      scope.row.materialSimpleAddrYl
                    "
                        :src="require('@/assets/images/home/sampleTable.png')"
                        alt=""
                    />
                    <!-- <span
                        @click="preView(scope.row, 'sample')"
                        v-if="
                          scope.row.materialSampleAddrYl ||
                          scope.row.materialSimpleAddrYl
                        "
                        >样表</span
                      >
                      <span
                        @click="preView(scope.row, 'empty')"
                        v-if="scope.row.materialEmptyAddr"
                        >空表</span
                      > -->
                  </p>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else-if="item.prop === 'operation'"
                align="center"
                width="330"
              >
                <template slot-scope="scope">
                  <div class="operationArea">
                    <el-upload
                      class="upload-demo"
                      action
                      :http-request="uploadFiles"
                      :before-upload="beforeUpload"
                      :on-error="uploadError"
                      :file-list="fileList"
                      :show-file-list="showFileList"
                    >
                      <p
                        size="mini"
                        type="primary"
                        @click="
                          pushMaterialOid(scope.row.caseMaterialOid, scope.row)
                        "
                      >
                        本地上传
                      </p>
                    </el-upload>
                    <p @click="scanCodeUpload(scope.row)">扫码上传</p>
                    <p>调取材料</p>
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else-if="item.prop === 'mustFlag'"
                align="center"
              >
                <template slot-scope="scope">
                  <div class="materialHis">
                    <!-- <span v-if="scope.row.flag === 'auto'">自动生成</span>
                      <span v-else-if="scope.row.flag === 'needUpload'"
                        >手动上传</span
                      >
                      <span v-else>可免于提交</span> -->
                    <p class="record">
                      <span
                        :class="
                          scope.row.showUploadPreview ? 'active' : 'noDrop'
                        "
                        @click="openUploadMaterialList(scope.row)"
                      >
                        {{ scope.row.showUploadPreview ? "查阅" : "未上传" }}
                      </span>
                      <!-- <img
                          :src="
                            scope.row.completeSubmit
                              ? require('@/assets/images/home/completeUpload.png')
                              : require('@/assets/images/home/noUpload.png')
                          "
                          alt=""
                        />
                        <img
                          :style="
                            scope.row.showUploadPreview
                              ? { cursor: 'pointer' }
                              : { cursor: 'no-drop' }
                          "
                          @click="openUploadMaterialList(scope.row)"
                          :src="
                            scope.row.showUploadPreview
                              ? require('@/assets/images/home/seePreview.png')
                              : require('@/assets/images/home/disPreview.png')
                          "
                          alt=""
                        /> -->
                    </p>
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else
                :show-overflow-tooltip="true"
              ></el-table-column>
            </template>
            <!-- <el-table-column type="expand" width="1">
                <template slot-scope="scope">
                  <div class="handle-data-list">
                    <template
                      v-for="(dataAtta, idx) in scope.row.qlCaseMaterialAttaList"
                    >
                      <div
                        class="handle-data-list-item"
                        :key="idx"
                        v-if="
                          !(
                            dataAtta.materialType === 'upload' || dataAtta.qlSysAtta
                          )
                        "
                      >
                        <div class="grid-content qdcg-text">
                          <div class="handle-data-list-item--link">
                            {{
                              dataAtta.originName
                                ? dataAtta.originName
                                : dataAtta.qlSysAtta.originName
                            }}
                          </div>
                        </div>
                        <div class="btnArea">
                          <el-button
                            type="text"
                            icon="el-icon-view"
                            @click="viewFile(dataAtta)"
                            >查看</el-button
                          >
                          <el-button
                            v-show="
                              dataAtta.materialType === 'upload' ||
                              dataAtta.qlSysAtta
                            "
                            type="text"
                            icon="el-icon-delete"
                            @click.stop="
                              deleteMaterialAtta(idx, scope.row.rowIndex, scope.row)
                            "
                            >删除
                          </el-button>
                        </div>
                      </div>
                    </template>
                  </div>
                </template>
              </el-table-column> -->
          </el-table>
        </div>
        <p class="dialogContentTitle">申请人自备材料</p>
        <div class="tableArea" ref="tableArea">
          <el-table
            border
            :data="selfPreparedMaterials"
            ref="selfPreparedMaterialsTable"
            style="width: 100%; margin-left: 1px"
            :row-key="getRowKey"
            :expand-row-keys="expandRowKeys"
          >
            <el-table-column type="index" label="序号" width="50">
            </el-table-column>
            <template v-for="(item, index) in columnList">
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-if="item.prop === 'materialName'"
                align="left"
              >
                <template slot-scope="scope">
                  <p class="preview">
                    <span>{{ scope.row.materialName }}</span>
                    <img
                      style="cursor: default"
                      v-show="scope.row.madeMaterialType === 1"
                      :src="require('@/assets/images/home/exemption.png')"
                      alt=""
                    />
                    <img
                      @click="preView(scope.row, 'empty')"
                      v-if="scope.row.materialEmptyAddr"
                      :src="require('@/assets/images/home/emptyTable.png')"
                      alt=""
                    />
                    <img
                      @click="preView(scope.row, 'sample')"
                      v-if="
                        scope.row.materialSampleAddrYl ||
                        scope.row.materialSimpleAddrYl
                      "
                      :src="require('@/assets/images/home/sampleTable.png')"
                      alt=""
                    />
                    <!-- <span
                        @click="preView(scope.row, 'sample')"
                        v-if="
                          scope.row.materialSampleAddrYl ||
                          scope.row.materialSimpleAddrYl
                        "
                        >样表</span
                      >
                      <span
                        @click="preView(scope.row, 'empty')"
                        v-if="scope.row.materialEmptyAddr"
                        >空表</span
                      > -->
                  </p>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else-if="item.prop === 'operation'"
                align="center"
                width="330"
              >
                <template slot-scope="scope">
                  <div class="operationArea">
                    <el-upload
                      class="upload-demo"
                      multiple
                      :limit="20"
                      :on-exceed="handleExceed"
                      action
                      :http-request="uploadFiles"
                      :before-upload="beforeUpload"
                      :on-error="uploadError"
                      :file-list="fileList"
                      :show-file-list="showFileList"
                    >
                      <p
                        size="mini"
                        type="primary"
                        @click="
                          pushMaterialOid(scope.row.caseMaterialOid, scope.row)
                        "
                      >
                        本地上传
                      </p>
                    </el-upload>
                    <p @click="scanCodeUpload(scope.row)">扫码上传</p>
                    <p>调取材料</p>
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else-if="item.prop === 'mustFlag'"
                align="center"
              >
                <template slot-scope="scope">
                  <div class="materialHis">
                    <!-- <span v-if="scope.row.flag === 'auto'">自动生成</span>
                      <span v-else-if="scope.row.flag === 'needUpload'"
                        >手动上传</span
                      >
                      <span v-else>可免于提交</span> -->
                    <p class="record">
                      <span
                        :class="
                          scope.row.showUploadPreview ? 'active' : 'noDrop'
                        "
                        @click="openUploadMaterialList(scope.row)"
                      >
                        {{ scope.row.showUploadPreview ? "查阅" : "未上传" }}
                      </span>
                      <!-- <img
                          :src="
                            scope.row.completeSubmit
                              ? require('@/assets/images/home/completeUpload.png')
                              : require('@/assets/images/home/noUpload.png')
                          "
                          alt=""
                        />
                        <img
                          :style="
                            scope.row.showUploadPreview
                              ? { cursor: 'pointer' }
                              : { cursor: 'no-drop' }
                          "
                          @click="openUploadMaterialList(scope.row)"
                          :src="
                            scope.row.showUploadPreview
                              ? require('@/assets/images/home/seePreview.png')
                              : require('@/assets/images/home/disPreview.png')
                          "
                          alt=""
                        /> -->
                    </p>
                  </div>
                </template>
              </el-table-column>
              <el-table-column
                :key="index"
                :label="item.label"
                :prop="item.prop"
                v-else
                :show-overflow-tooltip="true"
              ></el-table-column>
            </template>
            <!-- <el-table-column type="expand" width="1">
                <template slot-scope="scope">
                  <div class="handle-data-list">
                    <div
                      class="handle-data-list-item"
                      v-for="(dataAtta, idx) in scope.row.qlCaseMaterialAttaList"
                      :key="idx"
                    >
                      <div class="grid-content qdcg-text">
                        <div class="handle-data-list-item--link">
                          {{
                            dataAtta.originName
                              ? dataAtta.originName
                              : dataAtta.qlSysAtta.originName
                          }}
                        </div>
                      </div>
                      <div class="btnArea">
                        <el-button
                          type="text"
                          icon="el-icon-view"
                          @click="viewFile(dataAtta)"
                          >查看</el-button
                        >
                        <el-button
                          type="text"
                          icon="el-icon-delete"
                          @click.stop="
                            deleteMaterialAtta(idx, scope.row.rowIndex, scope.row)
                          "
                          >删除
                        </el-button>
                      </div>
                    </div>
                  </div>
                </template>
              </el-table-column> -->
          </el-table>
        </div>
      </div>
      <div class="tips">
        <p>本地上传说明：</p>
        <p>1. 允许上传文件格式：JPG、PNG、PDF；</p>
        <p>2. 最大允许上传文件大小：20M；</p>
        <p>
          3.
          一个材料可上传多份文件，若需要重新上传，请点击状态栏列中“查阅”在弹出框中删除文件后重新上传。
        </p>
      </div>
    </div>

    <div class="guidance-foot">
      <p @click="toLastStep"><span>上一步</span></p>
      <!-- <p @click="saveData">保存</p> -->
      <p @click="toNextStep">下一步</p>
    </div>
    <el-dialog
      v-dialog-drag
      title="扫码上传"
      :visible.sync="eleShow"
      custom-class="preview-dialog"
      width="600px"
      height="400px"
      append-to-body
    >
      <div
        style="
          width: 100%;
          display: flex;
          justify-content: center;
          margin-bottom: 20px;
        "
      >
        <img :src="imgUrl" alt="二维码" />
      </div>
      <div style="text-align: center">
        <strong>请用手机浏览器扫描上方二维码进行材料上传。</strong>
      </div>
    </el-dialog>
    <el-dialog
      v-dialog-drag
      title="预览"
      :visible.sync="showPreview"
      class="assistantNoticeDialog"
      width="80%"
    >
      <div class="previewArea">
        <iframe
          :src="preViewUrl"
          frameborder="0"
          style="height: 70vh; width: 100%"
        ></iframe>
      </div>
    </el-dialog>
    <el-dialog
      :visible.sync="complateVisible"
      width="60rem"
      center
      :show-close="false"
      class="complateVisible"
      v-dialogDrag
    >
      <img :src="require('@/assets/images/pad/complateProgress.png')" alt="" />
      <p>办事人材料是否已经全部提交？</p>
      <div slot="footer" class="dialog-footer">
        <p @click="closeComplateVisible">取消</p>
        <p @click="continueHandle('0')">否，需要办事人补交材料</p>
        <p type="primary" @click="continueHandle('1')">是，材料准备完成</p>
      </div>
    </el-dialog>
    <el-dialog
      title="帮办告知单"
      :visible.sync="showAssistantNotice"
      width="55%"
      class="assistantNoticeDialog"
      v-dialogDrag
    >
      <assistantNotice
        id="print"
        :baseUserInfo="baseUserInfo"
        v-if="showAssistantNotice"
        
      />
      <div slot="footer" class="dialog-footer">
        <p
          @click="toCloseService"
          :class="completePrint && pushUser ? '' : 'noPrint'"
        >
          已打印返回首页
        </p>
        <p @click="pushHandling">一键推送</p>
        <p v-print="printObj">打印</p>
      </div>
    </el-dialog>
    <el-dialog
      title="上传材料列表"
      :visible.sync="showUploadMaterial"
      width="70%"
      class="assistantNoticeDialog"
      v-dialogDrag
    >
      <div class="uploadList">
        <template v-for="(item, index) in showUploadMaterialList">
          <div
            class="uploadItem"
            v-if="item.qlSysAtta || item.materialType === 'upload'"
            :key="index"
            @click="viewFile(item)"
          >
            <img
              @click.stop="deleteMaterialAtta(index, showUploadMaterialIndex)"
              class="delete"
              :src="require('@/assets/images/home/delete.png')"
              alt=""
            />
            <img
              :src="
                require(`@/assets/images/home/${
                  item.originName
                    ? item.originName.split('.')[1].toLowerCase()
                    : item.qlSysAtta.originName.split('.')[1].toLowerCase()
                }Icon.png`)
              "
              alt=""
            />
            <p>
              {{
                item.originName ? item.originName : item.qlSysAtta.originName
              }}
            </p>
          </div>
        </template>
      </div>
    </el-dialog>
  </div>
</template>
<script>
import {
  queryQlCaseMaterialListByCaseOid,
  uploadCaseMaterialFile,
  nextStepSaveQlCase,
  updateQlCaseMaterialList,
  saveOrUpdateCaseMaterialAttaList,
  handlingOnekeyPush,
  pushData,
  querySysAttaByOid,
} from "@/api/modules/business.js";
import { completeService, updateService } from "@/api/modules/helpAgent";
import { encode, deepClone } from "@/utils/index";
import QRCode from "qrcode";
import assistantNotice from "./assistantNotice.vue";
export default {
  name: "MaterialUpload",
  components: {
    assistantNotice,
  },
  props: {
    serviceType: {
      type: String,
      default: () => null,
    },
    baseUserInfo: {
      type: Object,
      default: () => {},
    },
    sxServiceMaterialList: {
      type: Array,
      default: () => [],
    },
    currentServiceIndex: {
      type: Number,
      default: () => 0,
    },
  },
  data() {
    let that = this;
    return {
      printObj: {
        id: "print", // 这里是要打印元素的ID
        popTitle: "", // 打印的标题
        extraCss: "", // 打印可引入外部的一个 css 文件
        extraHead: "", // 打印头部文字
        previewBeforeOpenCallback() {
          console.log("正在加载预览窗口！");
          console.log(that.msg, this);
        }, // 预览窗口打开之前的callback
        previewOpenCallback() {
          console.log("已经加载完预览窗口，预览打开了！");
        }, // 预览窗口打开时的callback
        openCallback(e) {}, // 调用打印时的callback
        closeCallback(e) {
          that.completePrint = true;
          that.$store.commit("setServiceOperateStatus", true);
        }, // 关闭打印的callback(无法区分确认or取消,暂时无法解决)
        clickMounted() {
          console.log("点击v-print绑定的按钮了！");
        },
      },
      tableLoading: false,
      complateVisible: false,
      showAssistantNotice: false,
      completePrint: false,
      pushUser: false,
      showUploadMaterial: false,
      autoProduceTableHeight: 100,
      tableHeight: 300,
      columnList: [
        { label: "材料名称", prop: "materialName" },
        { label: "是否需要材料上传", prop: "mustFlag" },
        { label: "操作", prop: "operation" },
      ],
      eleShow: false,
      imgUrl: "",
      autoProduceMaterialList: [],
      selfPreparedMaterials: [],
      materialList: this.baseUserInfo.sxServiceMaterialList,
      fileList: [],
      showFileList: false,
      row: {},
      loading: "",
      showPreview: false,
      preViewUrl: "",
      materialPreviewList: [],
      associatedAttachmentsList: this.baseUserInfo.associatedAttachmentsList,
      afterService: "",
      getRowKey(row) {
        return row.id; // 返回当前行id
      },
      expandRowKeys: [],
      needSubmittedDataList: [],
      timer: "",
      materialInfo: {},
      isEmpty: false,
      table: null,
      showUploadMaterialList: [],
      showUploadMaterialIndex: 0,
    };
  },
  computed: {},
  mounted() {
    this.getSituationMaterialListByOids();
  },
  beforeDestroy() {
    clearInterval(this.timer);
  },
  methods: {
    downLoadAutoGenerate(data) {
      // let link = document.createElement("a");
      // let url = data.qlCaseMaterialAttaList[0].templatePdfUrl; //地址
      // // 这里是将url转成blob地址，
      // fetch(url)
      //   .then((res) => res.blob())
      //   .then((blob) => {
      //     // 将链接地址字符内容转变成blob地址

      //     link.href = URL.createObjectURL(blob);
      //     console.log(link.href);
      //     link.download = "";
      //     document.body.appendChild(link);
      //     link.click();
      //   });

      const that = this;
      var oReq = new XMLHttpRequest();
      var URL = data.qlCaseMaterialAttaList[0].templatePdfUrl; // URL 为URL地址
      oReq.open("GET", URL, true);
      oReq.responseType = "blob";
      oReq.onload = function () {
        var file = new Blob([oReq.response], {
          type: "blob",
        });
        FileSaver.saveAs(file); // that.name为文件名
      };
      oReq.send();
    },

    preView(data, type) {
      if (type === "sample") {
        if (data.materialSampleAddrYl) {
          this.preViewUrl = data.materialSampleAddrYl;
          // window.open(data.materialSampleAddrYl);
        }
        if (data.materialSimpleAddrYl) {
          this.preViewUrl = data.materialSimpleAddrYl;
          // window.open(data.materialSimpleAddrYl);
        }
        if (/\.(pdf|PDF)$/.test(this.preViewUrl)){
          android.openPdf(this.preViewUrl);
        }else if (/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(this.preViewUrl)) {
          this.showPreview = true;
        } else {
          window.open(this.preViewUrl);
        }
      } else if (type === "autoGenerate") {
        data.qlCaseMaterialAttaList.forEach((item) => {
          if (item.materialType != "upload" && !item.qlSysAtta) {
            this.preViewUrl = item.templatePdfUrl;
          }
        });
        if (/\.(pdf|PDF)$/.test(this.preViewUrl)){
          android.openPdf(this.preViewUrl);
        }else if (/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(this.preViewUrl)) {
          this.showPreview = true;
        } else {
          window.open(this.preViewUrl);
        }
      } else if (type === "autoGenerateDown") {
        data.qlCaseMaterialAttaList.forEach((item) => {
          if (item.materialType != "upload" && !item.qlSysAtta) {
            this.preViewUrl = item.templatePdfUrlWord;
          }
        });
        if (/\.(pdf|PDF)$/.test(this.preViewUrl)){
          android.openPdf(this.preViewUrl);
        }else if (/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(this.preViewUrl)) {
          this.showPreview = true;
        } else {
          window.open(this.preViewUrl);
        }
      } else {
        this.querySysAttaByOid(data.materialEmptyAddr);
      }
    },

    querySysAttaByOid(oid) {
      const params = {
        oid: oid,
      };
      querySysAttaByOid(params).then((res) => {
        if (res.code === 200) {
          if (res.data.filePath) {
            this.preViewUrl = res.data.filePath;
            if (/\.(pdf|PDF)$/.test(this.preViewUrl)){
              android.openPdf(this.preViewUrl);
            }else if (
              /\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(this.preViewUrl)
            ) {
              this.showPreview = true;
            } else {
              window.open(this.preViewUrl);
            }
          }
        }
      });
    },

    //打开文件上传列表
    openUploadMaterialList(data) {
      if (!data.showUploadPreview) {
        return;
      }
      this.showUploadMaterial = true;
      this.showUploadMaterialList = data.qlCaseMaterialAttaList;
      this.showUploadMaterialIndex = data.rowIndex;
    },
    handleExceed() {
      this.$message.warning("当前限制上传 最多20 个文件");
    },
    //预览附件
    viewFile(data) {
      if (data.qlSysAtta) {
        this.preViewUrl = data.qlSysAtta.fastdfsNginxUrl;
      } else {
        if (data.fastdfsNginxUrl) {
          this.preViewUrl = data.fastdfsNginxUrl;
        } else {
          this.preViewUrl = data.templatePdfUrl;
        }
      }
      if (/\.(gif|jpg|jpeg|png|GIF|JPG|PNG|pdf|PDF)$/.test(this.preViewUrl)) {
        this.showPreview = true;
      } else {
        window.open(this.preViewUrl);
      }
    },
    deleteMaterialAtta(index, rowIndex) {
      this.showUploadMaterialList.splice(index, 1);
      this.materialList[rowIndex].qlCaseMaterialAttaList.splice(index, 1);
      this.$nextTick(() => {
        this.materialList = [...this.materialList];
      });
      if (!this.showUploadMaterialList.length) {
        this.showUploadMaterial = false;
        this.$set(this.materialList[rowIndex], "showUploadPreview", false);
        this.$set(this.materialList[rowIndex], "completeSubmit", false);
      } else {
        if (this.materialList[rowIndex].flag === "auto") {
          const result = this.materialList[
            rowIndex
          ].qlCaseMaterialAttaList.some((item) => {
            return item.qlSysAtta || item.materialType === "upload";
          });
          if (!result) {
            this.showUploadMaterial = false;
            this.$set(this.materialList[rowIndex], "showUploadPreview", false);
          }
          const uploadMaterial = this.materialList[
            rowIndex
          ].qlCaseMaterialAttaList.filter((ite) => {
            return ite.qlSysAtta || ite.materialType === "upload";
          });
          if (
            Number(this.materialList[rowIndex].paperNumber) >
            uploadMaterial.length
          ) {
            this.$set(this.materialList[rowIndex], "completeSubmit", false);
          }
        } else {
          const uploadMaterial =
            this.materialList[rowIndex].qlCaseMaterialAttaList.length;
          if (
            Number(this.materialList[rowIndex].paperNumber) >
            uploadMaterial.length
          ) {
            this.$set(this.materialList[rowIndex], "completeSubmit", false);
          }
        }
      }
    },
    pushHandling() {
      const obj = {
        caseOid: this.baseUserInfo.caseOid,
        serviceOid: this.baseUserInfo.specificMatters.serviceOid,
        pushType: "2",
        name: this.baseUserInfo.name,
        cardNo: this.baseUserInfo.cardNo,
        companyName: this.baseUserInfo.companyName,
        companyCode: this.baseUserInfo.companyCode,
      };
      handlingOnekeyPush(obj).then((res) => {
        if (res.code === 200) {
          this.pushUser = true;
          this.$message.success("推送成功");
        }
      });
    },
    toCloseService() {
      if (this.completePrint && this.pushUser) {
        this.showAssistantNotice = false;
        //跳转到首页
        this.$emit("setResetBaseUserInfo", this.currentServiceIndex);
        this.$emit("nextStep", "mattersHandling");
      }
    },
    //获取材料列表
    getSituationMaterialListByOids() {
      const data = {
        caseOid: this.baseUserInfo.caseOid,
      };
      this.tableLoading = true;
      queryQlCaseMaterialListByCaseOid(data)
        .then((res) => {
          if (res.code === 200) {
            // this.tableHeight = this.$refs.tableArea.clientHeight;
            this.tableLoading = false;
            res.data.autoProduceMaterialList.forEach((item) => {
              item.flag = "auto";
              if (item.qlCaseMaterialAttaList.length) {
                item.qlCaseMaterialAttaList.forEach((ite) => {
                  ite.materialType = "autoGenerate";
                  if (ite.qlSysAtta) {
                    ite.originName = ite.qlSysAtta.originName;
                  } else {
                    ite.originName = item.materialName;
                    if (ite.templatePdfUrl && ite.templatePdfUrlWord) {
                      item.showPreviewType = "all";
                    } else if (ite.templatePdfUrl && !ite.templatePdfUrlWord) {
                      item.showPreviewType = "preview";
                    } else if (!ite.templatePdfUrl && ite.templatePdfUrlWord) {
                      item.showPreviewType = "download";
                    } else {
                      item.showPreviewType = null;
                    }
                  }
                });

                const result = item.qlCaseMaterialAttaList.some((item) => {
                  return item.qlSysAtta;
                });
                if (result) {
                  item.showUploadPreview = true; //是否有上传材料
                } else {
                  item.showUploadPreview = false; //无上传材料
                }
                const uploadMaterial = item.qlCaseMaterialAttaList.filter(
                  (ite) => {
                    return ite.qlSysAtta || ite.materialType === "upload";
                  }
                );
                if (Number(item.paperNumber) > uploadMaterial.length) {
                  item.completeSubmit = false;
                } else {
                  item.completeSubmit = true; //材料附件是否上传完
                }
              } else {
                item.showUploadPreview = false;
                item.completeSubmit = false;
              }
            });
            res.data.needUploadMaterialList.forEach((item) => {
              item.flag = "needUpload";
              if (item.qlCaseMaterialAttaList.length) {
                item.showUploadPreview = true;
                item.qlCaseMaterialAttaList.forEach((ite) => {
                  ite.originName = ite.qlSysAtta.originName;
                });
                const uploadMaterial = item.qlCaseMaterialAttaList.length;
                if (Number(item.paperNumber) > uploadMaterial.length) {
                  item.completeSubmit = false;
                } else {
                  item.completeSubmit = true;
                }
              } else {
                item.showUploadPreview = false;
                item.completeSubmit = false;
              }
            });
            res.data.noSubmissionMaterialList.forEach((item) => {
              item.flag = "noSubmission";
              if (item.qlCaseMaterialAttaList.length) {
                item.showUploadPreview = true;
                item.qlCaseMaterialAttaList.forEach((ite) => {
                  ite.originName = ite.qlSysAtta.originName;
                });
                const uploadMaterial = item.qlCaseMaterialAttaList.length;
                if (Number(item.paperNumber) > uploadMaterial.length) {
                  item.completeSubmit = false;
                } else {
                  item.completeSubmit = true;
                }
              } else {
                item.showUploadPreview = false;
                item.completeSubmit = false;
              }
            });
            this.materialList = [
              ...res.data.autoProduceMaterialList,
              ...res.data.needUploadMaterialList,
              ...res.data.noSubmissionMaterialList,
            ];
            this.materialList.forEach((item, index) => {
              item.rowIndex = index;
              item.quantityMaterials = 0;
              if (item.qlCaseMaterialAttaList.length) {
                if (item.flag === "auto") {
                  item.quantityMaterials = item.qlCaseMaterialAttaList.length;
                  this.expandRowKeys.push(item.id);
                }

                // if(item.){}
              } else {
                item.showUploadPreview = false;
              }
              if (item.flag === "auto") {
                this.autoProduceMaterialList.push(item);
              } else {
                this.selfPreparedMaterials.push(item);
              }
            });
            this.$nextTick(() => {
              this.materialList = [...this.materialList];
            });

            this.$emit("setSxServiceMaterialList", this.materialList);
          }
        })
        .catch((err) => {
          this.tableLoading = false;
        });
    },
    /** 上传附件 */
    uploadFiles(file) {
      const loading = this.$loading({
        lock: true,
        text: "正在上传文件",
        spinner: "el-icon-loading",
        background: "rgba(0, 0, 0, 0.7)",
      });
      let formData = new FormData();
      formData.append("files", file.file);
      uploadCaseMaterialFile(formData)
        .then((res) => {
          loading.close();
          if (res.code === 200) {
            if (res.data.length) {
              res.data.forEach((ite) => {
                ite.materialType = "upload";
              });

              this.materialList[this.attaIndex].qlCaseMaterialAttaList = [
                ...this.materialList[this.attaIndex].qlCaseMaterialAttaList,
                ...res.data,
              ];
              this.materialList[this.attaIndex].collectionType = "2";
              this.materialList[this.attaIndex].showUploadPreview = true;

              const uploadMaterial = this.materialList[
                this.attaIndex
              ].qlCaseMaterialAttaList.filter((ite) => {
                return ite.materialType === "upload";
              });
              if (
                Number(this.materialList[this.attaIndex].paperNumber) >
                uploadMaterial.length
              ) {
                this.$set(
                  this.materialList[this.attaIndex],
                  "completeSubmit",
                  false
                );
              } else {
                this.$set(
                  this.materialList[this.attaIndex],
                  "completeSubmit",
                  true
                );
              }

              this.$emit("setSxServiceMaterialList", this.materialList);
              this.$nextTick(() => {
                this.materialList = [...this.materialList];
              });
              // this.toUpdateQlCaseMaterialList(
              //   this.materialList[this.attaIndex]
              // );
              // this.submitFileForm();
            } else {
              this.$message.error("材料溜走了");
            }
          }
        })
        .catch((err) => {
          this.uploadError();
        });
    },
    //扫码上传
    async scanCodeUpload(data) {
      clearInterval(this.timer);
      this.materialInfo = {
        caseMaterialOid: data.caseMaterialOid,
        materialOid: data.materialOid,
      };
      this.imgUrl = await QRCode.toDataURL(
        // `http://101.230.251.254:81/materialUpload?caseMaterialOid=${data.caseMaterialOid}&materialOid=${data.materialOid}&collectionType=2`
        // `http://172.168.253.71:81/materialUpload?caseMaterialOid=${data.caseMaterialOid}&materialOid=${data.materialOid}&collectionType=2`
        `https://onlineserve.shhuangpu.gov.cn/bangban/materialUpload?caseMaterialOid=${data.caseMaterialOid}&materialOid=${data.materialOid}&collectionType=2`
        );
      this.eleShow = true;
      this.getMaterialList();
    },
    //上传之前
    beforeUpload(file) {
      if (
        file.name.indexOf("%00") > -1 ||
        file.name.indexOf("./") > -1 ||
        file.name.indexOf(".\\") > -1
      ) {
        this.msgError("上传文件名称非法！");
        return false;
      }
      if (!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG|pdf|PDF)$/.test(file.name)) {
        this.$message.warning("只允许上传图片和pdf文件");
        return false;
      }
      const fileSize = file.size;
      if (0 == fileSize) {
        this.msgError("上传文件不能为空！");
        return false;
      }
      const isLt2M = file.size / 1024 / 1024 < 30;
      if (!isLt2M) {
        this.msgError("上传文件大小不能超过 30MB！");
      }
      return isLt2M;
    },
    //失败后返回
    uploadError(resp) {
      // this.$message.error("文件上传失败");
    },

    //更新材料关联
    toUpdateQlCaseMaterialList() {
      const params = [];
      this.materialList.forEach((item) => {
        if (item.qlCaseMaterialAttaList.length - item.quantityMaterials > 0) {
          item.collectionFlag = 1;
          item.attaList = item.qlCaseMaterialAttaList;
          item.collectionNumber =
            item.qlCaseMaterialAttaList.length - item.quantityMaterials;
          params.push(item);
        }
      });
      updateQlCaseMaterialList(params).then((res) => {
        if (res.code === 200) {
          console.log(res.data);
        }
      });
    },

    // 提交上传文件
    submitFileForm() {
      const params = [];
      this.materialList.forEach((item) => {
        if (item.qlCaseMaterialAttaList.length - item.quantityMaterials > 0) {
          const obj = {
            caseMaterialOid: item.caseMaterialOid,
            collectionType: "2",
            materialOid: item.materialOid,
            collectionFlag: 1,
            qlCaseMaterialAttaList: [],
          };
          if (item.qlCaseMaterialAttaList.length) {
            item.qlCaseMaterialAttaList.forEach((it) => {
              const ob = {
                attaOid: it.attaOid,
                caseMaterialOid: item.caseMaterialOid,
                src: it.fastdfsNginxUrl,
              };
              obj.qlCaseMaterialAttaList.push(ob);
            });
          }
          params.push(obj);
        }
      });
      saveOrUpdateCaseMaterialAttaList(params)
        .then((res) => {
          if (res.code === 200) {
            // this.$message.success("材料附件已更新");
            this.showAssistantNotice = true;
          }
        })
        .catch((err) => {
          console.log(err);
        });
    },

    //扫码上传接口轮询
    getMaterialList() {
      const that = this;
      that.isEmpty = false;
      that.timer = setInterval(() => {
        const data = {
          caseOid: that.baseUserInfo.caseOid,
        };
        queryQlCaseMaterialListByCaseOid(data).then((res) => {
          if (res.code === 200) {
            // let materialList = [];
            let materialList = [
              ...res.data.autoProduceMaterialList,
              ...res.data.needUploadMaterialList,
              ...res.data.noSubmissionMaterialList,
            ];
            materialList.forEach((item, index) => {
              if (
                item.caseMaterialOid === this.materialInfo.caseMaterialOid &&
                item.materialOid === this.materialInfo.materialOid
              ) {
                if (item.qlCaseMaterialAttaList.length) {
                  if (!this.materialList[index].qlCaseMaterialAttaList.length) {
                    that.isEmpty = true;
                    this.materialList[index].qlCaseMaterialAttaList =
                      item.qlCaseMaterialAttaList;
                  } else {
                    item.qlCaseMaterialAttaList.forEach((ite) => {
                      const result = this.materialList[
                        index
                      ].qlCaseMaterialAttaList.find((data) => {
                        return data.attaOid === ite.attaOid;
                      });
                      if (!result) {
                        this.materialList[index].qlCaseMaterialAttaList.push(
                          ite
                        );
                      }
                    });
                  }
                  this.$nextTick(() => {
                    this.materialList = [...this.materialList];
                    this.autoProduceMaterialList = [
                      ...this.autoProduceMaterialList,
                    ];
                    this.selfPreparedMaterials = [
                      ...this.selfPreparedMaterials,
                    ];
                  });
                }
              }
            });
          }
        });
      }, 5000);
    },

    pushMaterialOid(materialOid, row) {
      this.materialOid = materialOid;
      this.attaIndex = row.rowIndex; //标识材料索引
      this.row = row;
    },
    toLastStep() {
      if (this.baseUserInfo.skipSmartForms) {
        this.$emit("nextStep", "essentialInformation", "2");
      } else {
        this.$emit("nextStep", "intelligentFormFilling", 3);
      }
    },
    saveData() {},
    toNextStep() {
      this.complateVisible = true;
    },

    nextStepSaveQlCase(status) {
      nextStepSaveQlCase({
        ...this.baseUserInfo.fillUserInfo,
        id: "",
        applyOid: "",
        applyNumber: "1",
        extOid: "",
        caseOid: this.baseUserInfo.caseOid,
        caseStatus: status,
        applyUserType: this.baseUserInfo.fillUserInfo.applyUserType,
        serviceOid: this.baseUserInfo.specificMatters.serviceOid,
        sourceType: "1",
        caseNumber: this.baseUserInfo.caseNumber,
        sxServiceMaterialList: this.baseUserInfo.sxServiceMaterialList,
        qlCaseTitleValList: this.baseUserInfo.qlCaseTitleValList,
      }).then((res) => {
        if (res.code === 200) {
          if (status === "1") {
            this.pushData();
          }
          this.$store.commit("setServiceOperateStatus", true);
          // this.completeService(status);
          this.toUpdateService(status);
        }
      });
    },
    pushData() {
      const params = {
        caseOid: this.baseUserInfo.caseOid,
      };
      pushData(params).then((res) => {
        if (res.code === 200) {
          this.$message.success("推送成功");
        }
      });
    },
    //完成服务
    completeService(status) {
      // console.log("serviceStatus------------"+status)
      let data = {
        workQueueId: this.baseUserInfo.id,
        serviceType: this.baseUserInfo.serviceType,
        serviceMemo: this.baseUserInfo.specificMatters.serviceName
          ? encode(this.baseUserInfo.specificMatters.serviceName)
          : "",
        sxServiceId: this.baseUserInfo.specificMatters.serviceOid,
        qlCaseId: this.baseUserInfo.caseOid,
        pushMemo: "",
        nextServiceAdvise: "3",
        distributionAdvise: "",
        serviceStatus: status === "1" ? "1" : "2",
        caseNumber: this.baseUserInfo.caseNumber,
      };
      completeService(data)
        .then((res) => {
          this.complateVisible = false;
          if (res.code === 200) {
            this.$store.commit("setServiceOperateStatus", true);
            this.toUpdateService(status);
          }
        })
        .catch((err) => {
          this.complateVisible = false;
        });
    },

    //更新服务
    toUpdateService(status) {
      // console.log("serviceStatus------------------"+status)
      const params = {
        haWorkServiceId: this.baseUserInfo.haWorkServiceId,
        serviceStatus: status === "1" ? "1" : "2",
      };
      updateService(params).then((res) => {
        if (res.code === 200) {
        }
      });
    },

    closeComplateVisible() {
      this.complateVisible = false;
    },
    continueHandle(type) {
      clearInterval(this.timer);
      if (type === "1") {
        const result = this.materialList.some((item) => {
          const uploadMaterial = item.qlCaseMaterialAttaList.filter((ite) => {
            return ite.qlSysAtta || ite.materialType === "upload";
          });
          return Number(item.paperNumber) > uploadMaterial.length;
        });
        if (result) {
          this.$message.warning("材料未全部提交");
          return;
        }
      }

      this.toUpdateQlCaseMaterialList();
      this.submitFileForm();
      this.nextStepSaveQlCase(type);
    },
  },
  watch: {
    sxServiceMaterialList: {
      handler(val) {
        if (val) {
          this.materialList = val;
        }
      },
      deep: true,
    },
  },
};
</script>
<style lang="scss" scoped>
.materialUpload-container {
  width: 100%;
  height: 100%;
  background-color: #fff;
  padding: 1.5rem 1.5rem;
  // overflow: hidden;

  .material-content {
    width: 100%;
    height: calc(100% - 10rem);
    overflow-y: auto;
    &::-webkit-scrollbar {
      width: 0.4375rem;
      background-color: #fff;
    }

    &::-webkit-scrollbar-thumb {
      width: 0.4375rem;
      height: 0.625rem !important;
      // background: linear-gradient(270deg, #bf9e63 0%, #dfca98 100%);
      background: linear-gradient(270deg, #2473ff 0%, #56b1fd 100%);
      border-radius: 4px;
    }
    .materialList {
      width: 100%;
      height: auto;
      overflow-x: hidden;
      overflow-y: auto;
      .dialogContentTitle {
        width: 15.8333rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding-left: 3.25rem;
        position: relative;
        margin: 1.25rem 0;
        &:nth-child(1) {
          background: url("@/assets/images/home/interMaterialBack.png")
            no-repeat;
          background-size: 100% 100%;
          font-size: 1.3333rem;
          font-family: Microsoft YaHei;
          font-weight: 400;
          color: #0f3255;
        }
        &:nth-child(3) {
          background: url("@/assets/images/home/selfMaterialBack.png") no-repeat;
          background-size: 100% 100%;
          font-size: 1.3333rem;
          font-family: Microsoft YaHei;
          font-weight: 400;
          color: #482a07;
        }
      }
      .tableArea {
        width: 100%;
        height: auto;
        .el-table {
          width: 100%;
          ::v-deep .el-table__body-wrapper {
            &::-webkit-scrollbar {
              width: 0.4375rem;
              background-color: #fff;
            }

            &::-webkit-scrollbar-thumb {
              width: 0.4375rem;
              height: 0.625rem !important;
              // background: linear-gradient(270deg, #bf9e63 0%, #dfca98 100%);
              background: linear-gradient(270deg, #2473ff 0%, #56b1fd 100%);
              border-radius: 4px;
            }

            .el-table__body {
              .el-table__row {
                .el-table__cell {
                  .cell {
                    .preview {
                      width: 100%;
                      height: 100%;
                      display: flex;
                      align-items: center;
                      justify-content: flex-start;
                      span {
                        font-size: 14px;
                        margin-right: 17px;
                        font-family: Microsoft YaHei;
                        font-weight: 400;
                        color: #2a344c;
                      }
                      img {
                        width: 17px;
                        cursor: pointer;
                        margin-right: 19px;
                        cursor: pointer;
                      }
                    }
                    .materialHis {
                      width: 100%;
                      display: flex;
                      align-items: center;
                      justify-content: space-between;
                      .record {
                        width: 100%;
                        height: 100%;
                        padding-right: 3rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        span {
                          font-size: 14px;
                          font-family: Microsoft YaHei;
                          font-weight: 400;
                        }
                        .active {
                          text-decoration: underline;
                          color: #2575ff;
                          cursor: pointer;
                        }
                        .noDrop {
                          color: #2a344c;
                          cursor: no-drop;
                        }
                      }
                    }
                  }
                }
              }
            }
          }

          .el-table__expanded-cell {
            width: 100%;
            height: auto;

            .handle-data-list {
              width: 100%;
              height: auto;

              .handle-data-list-item {
                width: 100%;
                height: 3.125rem;
                padding: 0 2.5rem;
                display: flex;
                align-items: center;
                justify-content: space-between;
                .btnArea {
                  width: 12rem;
                }
              }
            }
          }

          ::v-deep .el-table__expand-icon {
            visibility: hidden;
          }

          .operationArea {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;

            p {
              cursor: pointer;
              padding: 0.5rem 1rem;
              margin-right: 1.5rem;
              display: flex;
              align-items: center;
              justify-content: center;

              font-family: MicrosoftYaHei;
              font-size: 1.5rem;
              font-weight: normal;
              font-stretch: normal;
              letter-spacing: 0px;
              color: #ffffff;
              border-radius: 3px;

              &:nth-child(1) {
                background: linear-gradient(265deg, #23a4ff 0%, #2778ff 100%);
              }

              &:nth-child(2) {
                background: linear-gradient(265deg, #23a4ff 0%, #2778ff 100%);
                margin-right: 1.0714rem;
              }

              &:nth-child(3) {
                background: linear-gradient(125deg, #f69b4a 0%, #fe8034 100%);
              }
            }
          }
        }
      }
    }
    .tips {
      width: 100%;
      height: auto;
      background: rgba(98, 154, 240, 0.05);
      border: 1px dotted #629af0;
      padding: 20px;
      margin-top: 21px;
      p {
        padding: 0;
        margin: 0;
        font-size: 14px;
        font-family: Microsoft YaHei;
        font-weight: 400;
        color: #2a344c;
        text-align: left;
        line-height: 30px;
        &:nth-child(1) {
          font-family: Microsoft YaHei;
          font-weight: 400;
          color: #121b2f;
        }
      }
    }
  }

  .guidance-foot {
    margin-top: 2.6667rem;
    width: 100%;
    height: 6.375rem;
    display: flex;
    align-items: center;
    justify-content: center;

    p {
      padding: 1px !important;
      background: linear-gradient(#e1eeff, #0977ff) !important;
      box-shadow: 0px 0.5rem 0px 0px rgba(106, 159, 231, 0.08) !important;
      border-radius: 2.1875rem !important;
      font-size: 1.8571rem;
      font-family: Microsoft YaHei;
      font-weight: 400;
      color: #6890e7;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 2.1875rem;
      span {
        padding: 1.375rem 3.75rem;
        display: block;
        width: 100%;
        height: 100%;
        border-radius: 2.1875rem;
        background-color: #fff;
      }

      &:nth-child(2) {
        padding: 1.375rem 3.75rem !important;
        border: none;
        background: linear-gradient(90deg, #6d93e8 0%, #77b0fe 100%) !important;
        box-shadow: 0px 0.4375rem 0px 0px rgb(106 159 231 / 31%),
          inset 0 0.4375rem 0.4375rem 0 rgb(188 212 251),
          inset -0.4375rem 0 0 0 rgb(114 173 249),
          inset 7px 0 0 0 rgb(107 146 230) !important;
        color: #ffffff;
      }
    }
  }
}

.el-dialog__wrapper {
  .el-dialog {
    .el-dialog__body {
      .previewArea {
        width: 100%;

        img {
          width: 100%;
        }
      }

      .materialPreviewArea {
        width: 100%;
        height: 75vh;
      }
      .uploadList {
        width: 100%;
        height: auto;
        padding: 2.5rem;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        flex-wrap: wrap;
        .uploadItem {
          width: 11.7647rem;
          height: 17.6471rem;
          margin-right: 2.5rem;
          position: relative;
          cursor: pointer;
          .delete {
            width: 3rem;
            height: 3rem;
            position: absolute;
            top: -1.5rem;
            left: 0.5rem;
            z-index: 1000;
          }
          img {
            width: 11.7647rem;
            height: 11.7647rem;
            cursor: pointer;
          }
          p {
            width: 100%;
            margin-top: 1.5rem;
            font-size: 1.7647rem;
            font-family: Microsoft YaHei;
            font-weight: 400;
            color: #373737;
            overflow: hidden; // 溢出隐藏
            display: -webkit-box; //  自适应布局 弹性伸缩盒子
            -webkit-box-orient: vertical; //垂直排列子元素 伸缩盒子的子元素排列
            -webkit-line-clamp: 2; //最多显示几行 多出部分。。。显示
            text-overflow: ellipsis; // 显示省略号
          }
        }
      }
    }
  }
}

.complateVisible {
  ::v-deep .el-dialog {
    width: 40rem;
    // height: 25.125rem;
    margin-top: calc(50vh - 12.5625rem) !important;

    .el-dialog__header {
      background: #fff !important;
    }

    .el-dialog__body {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 !important;

      img {
        width: 9rem;
      }

      p {
        font-size: 2rem;
        font-family: Source Han Sans CN;
        font-weight: 500;
        color: #373737;
        margin: 0.9375rem;
        padding: 0;
      }
    }

    .el-dialog__footer {
      height: 4.6875rem;
      margin-top: 5.9375rem;

      .dialog-footer {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        p {
          height: 100%;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.8rem;
          font-family: Source Han Sans CN;
          font-weight: 500;
          padding: 0;
          margin: 0;
          &:nth-child(1) {
            width: 33%;
            background: #a0bce1;
            border-radius: 0px 0px 0px 0.625rem;
            color: #645c4b;
          }

          &:nth-child(2) {
            width: 34%;
            background: #6090e3;
            color: #dbd2d2;
            border-radius: 0;
          }

          &:nth-child(3) {
            width: 34%;
            background: #3675e2;
            color: #ffffff;
            border-radius: 0px 0px 0.625rem 0;
          }
        }
      }
    }
  }
}
.assistantNoticeDialog {
  ::v-deep .el-dialog {
    height: 80vh;
    .dialog-footer {
      p {
        &:nth-child(1) {
          background: #ffffff;
          border: 1px solid #4988f2;
          box-shadow: 0px 0px 1.8125rem 0px rgba(204, 177, 121, 0.31);
          color: #2473ff;
          margin-right: 2.1875rem;
          cursor: pointer;
        }

        &:nth-child(2) {
          background: linear-gradient(90deg, #0093e7 0%, #17c3f5 100%);
          box-shadow: 0px 0px 1.5rem 0px rgb(40 107 198 / 31%);
          color: #ffffff;
          border: none;
        }

        &:nth-child(3) {
          color: #ffffff;
          background: linear-gradient(90deg, #2473ff 0%, #56b1fd 100%);
        }
      }
      .noPrint {
        cursor: not-allowed !important;
        border-color: #dcdfe6 !important;
        color: #c0c4cc !important;
      }
    }
  }
}
.procedure {
  word-wrap: break-word;
}
@media print {
  .noPrint {
    display: none;
  }
}
</style>
